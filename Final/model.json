{
  "metadata": {
    "name": "adaptive_therapy_resource_limited_v1",
    "version": "1.0.0",
    "time_units": "day",
    "state_units": {
      "T": "arb",
      "E": "arb",
      "H": "arb",
      "PDL1": "arb",
      "TGFb": "arb",
      "ctDNA": "assay",
      "Adr": "arb",
      "Cyc": "arb",
      "Tax": "arb",
      "Tam": "arb",
      "IO": "arb",
      "TIL": "arb",
      "N": "arb",
      "BM": "arb"
    }
  },
  "capacity_mode": "resource",
  "states": {
    "T": { "description": "Tumor burden" },
    "E": { "description": "Effector CD8+ T cells" },
    "H": { "description": "Helper CD4+ T cells" },
    "PDL1": { "description": "PD-L1 axis activity" },
    "TGFb": { "description": "TGF-β immunosuppression" },
    "ctDNA": { "description": "Circulating tumor DNA" },
    "Adr": { "description": "Adriamycin plasma conc." },
    "Cyc": { "description": "Cyclophosphamide plasma conc." },
    "Tax": { "description": "Taxane plasma conc." },
    "Tam": { "description": "Tamoxifen effect compartment" },
    "IO": { "description": "Checkpoint inhibitor effect" },
    "TIL": { "description": "Adoptive T cell infusion level" },
    "N": { "description": "Nutrient/oxygen resource (chemostat)" },
    "BM": { "description": "Bone marrow/immune setpoint resource" }
  },
  "equations_on": {
    "tumor_growth": { "on": true, "form": "resource_limited_chemostat" },
    "immune_dynamics": { "on": true, "form": "resource_limited_with_MM_stim_and_MM_exhaust" },
    "immune_kills_tumor": { "on": true, "form": "MM_effector" },
    "chemo_kills_tumor": { "on": true, "form": "emax_multi_agent_prolif_weighted" },
    "endocrine_modulation": { "on": true, "targets": ["T", "Ki67", "ER", "PR"] },
    "io_stimulates_immune": { "on": true, "form": "MM" },
    "til_boosts_immune": { "on": true, "form": "linear_small" },
    "ctDNA_shedding": { "on": true, "form": "linear_T_minus_clearance" },
    "drug_pk": { "on": true, "form": "one_compartment_first_order" },
    "toxicity_trackers": { "on": true, "drivers": ["Adr", "Cyc", "Tax", "Tam", "IO"] }
  },
  "interactions_graph": [
    { "from": "E", "to": "T", "type": "kill" },
    { "from": "Adr", "to": "T", "type": "kill" },
    { "from": "Cyc", "to": "T", "type": "kill" },
    { "from": "Tax", "to": "T", "type": "kill" },
    { "from": "Tam", "to": ["T", "Ki67", "ER", "PR"], "type": "modulate" },
    { "from": "ER", "to": "Ki67", "type": "promote" },
    { "from": "PR", "to": "Ki67", "type": "promote" },
    { "from": "Ki67", "to": "T", "type": "proliferate" },
    { "from": "PI3K", "to": ["Ki67", "T"], "type": "promote" },
    { "from": "ESR1m", "to": "ER", "type": "boost" },
    { "from": "IO", "to": "E", "type": "stimulate" },
    { "from": "TIL", "to": "E", "type": "boost" },
    { "from": "T", "to": "PDL1", "type": "upregulate" },
    { "from": "E", "to": "PDL1", "type": "upregulate" },
    { "from": "PDL1", "to": "E", "type": "block" },
    { "from": "PDL1", "to": "H", "type": "block" },
    { "from": "PDL1", "to": "T", "type": "boost" },
    { "from": "IO", "to": "PDL1", "type": "block" },
    { "from": "H", "to": "E", "type": "boost" },
    { "from": "T", "to": "H", "type": "stimulate" },
    { "from": "T", "to": "TGFb", "type": "secrete" },
    { "from": "TGFb", "to": "E", "type": "block" },
    { "from": "TGFb", "to": "H", "type": "block" },
    { "from": "T", "to": "ctDNA", "type": "shed" }
  ],
  "parameters": {
    "rT_max": { "role": "learnable", "description": "Max tumor proliferation under full nutrient", "units": "1/day", "bounds": [0.0001, 1.0], "initial_guess": 0.05 },
    "k_ET": { "role": "learnable", "description": "Immune kill coefficient", "units": "(arb·day)^-1", "bounds": [0.000001, 1.0], "initial_guess": 0.5 },
    "K_ET": { "role": "learnable", "description": "Half-sat for immune kill vs tumor", "units": "arb", "bounds": [0.000001, 2.0], "initial_guess": 0.2 },
    "k_Tam_ERPR": { "role": "learnable", "description": "Tam inhibition on ER/PR axis", "units": "1/day", "bounds": [0.0, 2.0], "initial_guess": 0.3 },
    "K_Tam": { "role": "learnable", "description": "Tam half-saturation (EC50-like)", "units": "arb", "bounds": [0.000001, 2.0], "initial_guess": 0.3 },
    "rE_max": { "role": "learnable", "description": "Max E proliferation under BM", "units": "1/day", "bounds": [0.0001, 1.0], "initial_guess": 0.1 },
    "rH_max": { "role": "learnable", "description": "Max H proliferation under BM", "units": "1/day", "bounds": [0.0001, 1.0], "initial_guess": 0.06 },
    "delta_E": { "role": "learnable", "description": "E turnover/exhaustion", "units": "1/day", "bounds": [0.0, 0.5], "initial_guess": 0.03 },
    "delta_H": { "role": "learnable", "description": "H turnover", "units": "1/day", "bounds": [0.0, 0.5], "initial_guess": 0.02 },
    "k_T_to_E": { "role": "learnable", "description": "Antigen-driven E stimulus (MM)", "units": "1/day", "bounds": [0.0, 2.0], "initial_guess": 0.2 },
    "K_Tstim_E": { "role": "learnable", "description": "Half-sat T→E", "units": "arb", "bounds": [0.000001, 2.0], "initial_guess": 0.3 },
    "k_T_to_H": { "role": "learnable", "description": "Antigen-driven H stimulus (MM)", "units": "1/day", "bounds": [0.0, 2.0], "initial_guess": 0.1 },
    "K_Tstim_H": { "role": "learnable", "description": "Half-sat T→H", "units": "arb", "bounds": [0.000001, 2.0], "initial_guess": 0.3 },
    "k_H_to_E": { "role": "learnable", "description": "Helper boosts E", "units": "1/day", "bounds": [0.0, 2.0], "initial_guess": 0.15 },
    "K_Hboost_E": { "role": "learnable", "description": "Half-sat H→E boost", "units": "arb", "bounds": [0.000001, 2.0], "initial_guess": 0.3 },
    "PDL1_basal": { "role": "fixed", "description": "Basal PD-L1 drive", "units": "arb/day", "value": 0.05 },
    "k_PDL1_up_T": { "role": "learnable", "description": "T upregulates PD-L1", "units": "1/day", "bounds": [0.0, 2.0], "initial_guess": 0.3 },
    "K_PDL1_up_T": { "role": "learnable", "description": "Half-sat for T→PDL1", "units": "arb", "bounds": [0.000001, 2.0], "initial_guess": 0.3 },
    "k_PDL1_up_E": { "role": "learnable", "description": "E upregulates PD-L1 (IFNγ)", "units": "1/day", "bounds": [0.0, 2.0], "initial_guess": 0.2 },
    "K_PDL1_up_E": { "role": "learnable", "description": "Half-sat for E→PDL1", "units": "arb", "bounds": [0.000001, 2.0], "initial_guess": 0.3 },
    "k_PDL1_decay": { "role": "fixed", "description": "PD-L1 decay", "units": "1/day", "value": 0.05 },
    "K_PDL1": { "role": "learnable", "description": "Half-sat for PD-L1 suppression", "units": "arb", "bounds": [0.000001, 2.0], "initial_guess": 0.3 },
    "n_PDL1": { "role": "fixed", "description": "Hill for PD-L1 suppression", "units": "none", "value": 1.0 },
    "phi_PD": { "role": "learnable", "description": "PD-L1 suppression strength", "units": "none", "bounds": [0.0, 1.0], "initial_guess": 0.7 },
    "k_IO_block_PDL1": { "role": "learnable", "description": "IO blocks PD-L1 axis", "units": "1/day", "bounds": [0.0, 2.0], "initial_guess": 0.4 },
    "k_T_secrete_TGFb": { "role": "learnable", "description": "T secretes TGF-β", "units": "1/day", "bounds": [0.0, 2.0], "initial_guess": 0.2 },
    "k_TGFb_decay": { "role": "fixed", "description": "TGF-β decay", "units": "1/day", "value": 0.05 },
    "K_TGFb": { "role": "learnable", "description": "Half-sat for TGF-β suppression", "units": "arb", "bounds": [0.000001, 2.0], "initial_guess": 0.3 },
    "n_TGFb": { "role": "fixed", "description": "Hill for TGF-β suppression", "units": "none", "value": 1.0 },
    "phi_TGFb": { "role": "learnable", "description": "TGF-β suppression strength", "units": "none", "bounds": [0.0, 1.0], "initial_guess": 0.5 },
    "K_IO": { "role": "learnable", "description": "IO EC50-like half-sat", "units": "arb", "bounds": [0.000001, 2.0], "initial_guess": 0.2 },
    "n_IO": { "role": "fixed", "description": "Hill for IO", "units": "none", "value": 1.0 },
    "gamma_IO": { "role": "learnable", "description": "IO immune stimulation gain", "units": "none", "bounds": [0.0, 1.0], "initial_guess": 0.4 },
    "Emax_Adr": { "role": "learnable", "description": "Adr max cytotoxic effect", "units": "1/day", "bounds": [0.0, 2.0], "initial_guess": 1.0 },
    "EC50_Adr": { "role": "learnable", "description": "Adr half-max concentration", "units": "arb", "bounds": [0.000001, 2.0], "initial_guess": 0.5 },
    "n_Adr": { "role": "fixed", "description": "Hill for Adr", "units": "none", "value": 1.0 },
    "Emax_Cyc": { "role": "learnable", "description": "Cyc max cytotoxic effect", "units": "1/day", "bounds": [0.0, 2.0], "initial_guess": 1.0 },
    "EC50_Cyc": { "role": "learnable", "description": "Cyc half-max concentration", "units": "arb", "bounds": [0.000001, 2.0], "initial_guess": 0.5 },
    "n_Cyc": { "role": "fixed", "description": "Hill for Cyc", "units": "none", "value": 1.0 },
    "Emax_Tax": { "role": "learnable", "description": "Tax max cytotoxic effect", "units": "1/day", "bounds": [0.0, 2.0], "initial_guess": 1.0 },
    "EC50_Tax": { "role": "learnable", "description": "Tax half-max concentration", "units": "arb", "bounds": [0.000001, 2.0], "initial_guess": 0.5 },
    "n_Tax": { "role": "fixed", "description": "Hill for Tax", "units": "none", "value": 1.0 },
    "K_N_prolif": { "role": "learnable", "description": "Nutrient half-sat for proliferative kill weighting", "units": "arb", "bounds": [0.000001, 2.0], "initial_guess": 0.2 },
    "sN": { "role": "learnable", "description": "N supply", "units": "arb/day", "bounds": [0.0, 5.0], "initial_guess": 0.5 },
    "dN": { "role": "learnable", "description": "N washout/decay", "units": "1/day", "bounds": [0.0, 1.0], "initial_guess": 0.1 },
    "qT": { "role": "learnable", "description": "N consumption by tumor", "units": "arb/(T·day)", "bounds": [0.0, 1.0], "initial_guess": 0.05 },
    "qE": { "role": "learnable", "description": "N consumption by E", "units": "arb/(E·day)", "bounds": [0.0, 1.0], "initial_guess": 0.03 },
    "K_N": { "role": "learnable", "description": "Half-sat for tumor growth vs N", "units": "arb", "bounds": [0.000001, 2.0], "initial_guess": 0.2 },
    "n_N": { "role": "fixed", "description": "Hill for tumor growth vs N", "units": "none", "value": 1.0 },
    "K_N_use_T": { "role": "fixed", "description": "Half-sat for N use by tumor", "units": "arb", "value": 0.2 },
    "K_N_use_E": { "role": "fixed", "description": "Half-sat for N use by E", "units": "arb", "value": 0.2 },
    "chi_N_chemo": { "role": "learnable", "description": "Chemo-induced drop in effective N", "units": "none/day", "bounds": [0.0, 1.0], "initial_guess": 0.05 },
    "sBM": { "role": "learnable", "description": "BM supply", "units": "arb/day", "bounds": [0.0, 2.0], "initial_guess": 0.2 },
    "dBM": { "role": "learnable", "description": "BM decay", "units": "1/day", "bounds": [0.0, 1.0], "initial_guess": 0.05 },
    "qBM_chemo": { "role": "learnable", "description": "Myelosuppression by chemo", "units": "1/day", "bounds": [0.0, 2.0], "initial_guess": 0.5 },
    "K_BM": { "role": "learnable", "description": "Half-sat for immune growth vs BM", "units": "arb", "bounds": [0.000001, 2.0], "initial_guess": 0.3 },
    "n_BM": { "role": "fixed", "description": "Hill for immune growth vs BM", "units": "none", "value": 1.0 },
    "gamma_BM_IO": { "role": "learnable", "description": "IO boosts BM recovery", "units": "none", "bounds": [0.0, 1.0], "initial_guess": 0.1 },
    "gamma_BM_TIL": { "role": "learnable", "description": "TIL boosts BM recovery", "units": "none", "bounds": [0.0, 1.0], "initial_guess": 0.05 },
    "K_TIL": { "role": "fixed", "description": "Half-sat for TIL signal", "units": "arb", "value": 0.2 },
    "p_ct": { "role": "learnable", "description": "ctDNA shedding per tumor", "units": "assay/(T·day)", "bounds": [0.0, 10.0], "initial_guess": 0.05 },
    "k_ctclr": { "role": "fixed", "description": "ctDNA clearance", "units": "1/day", "value": 0.2 },
    "lambda_Adr": { "role": "fixed", "description": "Adr decay (PK)", "units": "1/day", "value": 0.2 },
    "lambda_Cyc": { "role": "fixed", "description": "Cyc decay (PK)", "units": "1/day", "value": 0.2 },
    "lambda_Tax": { "role": "fixed", "description": "Tax decay (PK)", "units": "1/day", "value": 0.2 },
    "lambda_Tam": { "role": "fixed", "description": "Tam decay (PK)", "units": "1/day", "value": 0.1 },
    "lambda_IO": { "role": "fixed", "description": "IO decay (PK)", "units": "1/day", "value": 0.1 },
    "lambda_TIL": { "role": "fixed", "description": "TIL decay (PK)", "units": "1/day", "value": 0.05 },
    "k_PDboost_T": { "role": "learnable", "description": "PD-L1/immune escape boosts tumor net growth", "units": "1/day", "bounds": [0.0, 1.0], "initial_guess": 0.2 }
  },
  "initial_conditions": {
    "T": 0.1,
    "E": 0.1,
    "H": 0.05,
    "PDL1": 0.05,
    "TGFb": 0.0,
    "ctDNA": 0.0,
    "Adr": 0.0,
    "Cyc": 0.0,
    "Tax": 0.0,
    "Tam": 0.0,
    "IO": 0.0,
    "TIL": 0.0,
    "N": 0.5,
    "BM": 0.8
  },
  "observation_map": {
    "ctDNA_assay": { "from_state": "ctDNA", "scale": 1.0, "offset": 0.0 },
    "tumor_proxy": { "from_state": "T", "scale": 1.0, "offset": 0.0 }
  },
  "control_spec": {
    "type": "policy",
    "mode": "closed_loop",
    "channels": ["Adr", "Cyc", "Tax", "Tam", "IO", "TIL"]
  },
  "parameters_fit_groups": {
    "learnable": [
      "rT_max",
      "k_ET",
      "K_ET",
      "k_Tam_ERPR",
      "K_Tam",
      "rE_max",
      "rH_max",
      "delta_E",
      "delta_H",
      "k_T_to_E",
      "K_Tstim_E",
      "k_T_to_H",
      "K_Tstim_H",
      "k_H_to_E",
      "K_Hboost_E",
      "k_PDL1_up_T",
      "K_PDL1_up_T",
      "k_PDL1_up_E",
      "K_PDL1_up_E",
      "K_PDL1",
      "phi_PD",
      "k_IO_block_PDL1",
      "k_T_secrete_TGFb",
      "K_TGFb",
      "phi_TGFb",
      "K_IO",
      "gamma_IO",
      "Emax_Adr",
      "EC50_Adr",
      "Emax_Cyc",
      "EC50_Cyc",
      "Emax_Tax",
      "EC50_Tax",
      "K_N_prolif",
      "sN",
      "dN",
      "qT",
      "qE",
      "K_N",
      "chi_N_chemo",
      "sBM",
      "dBM",
      "qBM_chemo",
      "K_BM",
      "gamma_BM_IO",
      "gamma_BM_TIL",
      "p_ct",
      "k_PDboost_T"
    ],
    "fixed": [
      "PDL1_basal",
      "k_PDL1_decay",
      "k_TGFb_decay",
      "n_PDL1",
      "n_TGFb",
      "n_IO",
      "n_Adr",
      "n_Cyc",
      "n_Tax",
      "n_N",
      "n_BM",
      "K_N_use_T",
      "K_N_use_E",
      "K_TIL",
      "k_ctclr",
      "lambda_Adr",
      "lambda_Cyc",
      "lambda_Tax",
      "lambda_Tam",
      "lambda_IO",
      "lambda_TIL"
    ],
    "derived": [],
    "priors": {
      "lognormal": {
        "rT_max": { "mean": 0.05, "sd": 0.02 },
        "rE_max": { "mean": 0.1, "sd": 0.05 },
        "rH_max": { "mean": 0.06, "sd": 0.03 },
        "sN": { "mean": 0.5, "sd": 0.25 },
        "sBM": { "mean": 0.2, "sd": 0.1 }
      },
      "gaussian": {
        "phi_PD": { "mean": 0.6, "sd": 0.2 },
        "phi_TGFb": { "mean": 0.4, "sd": 0.2 },
        "gamma_IO": { "mean": 0.4, "sd": 0.2 }
      },
      "halfnormal": {
        "Emax_Adr": { "sd": 0.5 },
        "Emax_Cyc": { "sd": 0.5 },
        "Emax_Tax": { "sd": 0.5 }
      }
    },
    "regularization": {
      "weight_decay": {
        "L2": [
          ["k_ET", 0.0001],
          ["K_ET", 0.0001],
          ["K_IO", 0.0001],
          ["K_N", 0.0001],
          ["K_BM", 0.0001]
        ]
      },
      "bounds_enforcement": { "method": "softplus_with_epsilon", "epsilon": 1e-8 }
    },
    "identifiability_hints": {
      "tie_groups": [
        ["n_Adr", "n_Cyc", "n_Tax"],
        ["K_N_use_T", "K_N_use_E"]
      ],
      "freeze_first": [
        "k_PDboost_T",
        "chi_N_chemo",
        "gamma_BM_TIL"
      ]
    },
    "training_schedule": [
      {
        "stage": 1,
        "epochs": 300,
        "unfreeze": [
          "rT_max",
          "k_ET",
          "K_ET",
          "Emax_Adr",
          "EC50_Adr",
          "Emax_Cyc",
          "EC50_Cyc",
          "Emax_Tax",
          "EC50_Tax",
          "sN",
          "dN",
          "K_N",
          "sBM",
          "dBM",
          "K_BM"
        ],
        "freeze": [
          "k_PDboost_T",
          "chi_N_chemo",
          "gamma_BM_TIL"
        ],
        "notes": "Fit core tumor/immune and resource dynamics + chemo PD."
      },
      {
        "stage": 2,
        "epochs": 300,
        "unfreeze": [
          "k_T_to_E",
          "K_Tstim_E",
          "k_T_to_H",
          "K_Tstim_H",
          "k_H_to_E",
          "K_Hboost_E",
          "K_N_prolif"
        ],
        "notes": "Add antigen/helper boosts and proliferative kill weighting."
      },
      {
        "stage": 3,
        "epochs": 300,
        "unfreeze": [
          "k_PDL1_up_T",
          "K_PDL1_up_T",
          "k_PDL1_up_E",
          "K_PDL1_up_E",
          "K_PDL1",
          "phi_PD",
          "k_IO_block_PDL1",
          "k_T_secrete_TGFb",
          "K_TGFb",
          "phi_TGFb",
          "K_IO",
          "gamma_IO",
          "k_Tam_ERPR",
          "K_Tam",
          "k_PDboost_T",
          "chi_N_chemo",
          "gamma_BM_IO",
          "gamma_BM_TIL"
        ],
        "notes": "Enable checkpoint/TGFβ/endocrine axes and indirect resource effects."
      }
    ]
  }
}
